version: 2

models:
  - name: stg_raw_events
    description: >
      **Staging model for event data.**
      
      Cleans and standardizes raw event data from the landing zone.
      Applies consistent naming conventions and data type casting.
      Filters out records with null event IDs to ensure data quality.
      
      **Transformations Applied:**
      - Casts event_timestamp to proper TIMESTAMP type
      - Renames columns to follow naming conventions
      - Filters records where event_id is null
      
      **Downstream Usage:**
      - Joined with stg_raw_users in int_events_enriched
      - Foundation for fct_events mart table
    config:
      tags: ['staging', 'events', 'daily']
    columns:
      - name: event_id
        description: '{{ doc("event_id") }}'
        tests:
          - not_null
          - unique
      - name: user_id
        description: '{{ doc("user_id") }}'
        tests:
          - not_null
          - relationships:
              to: ref('stg_raw_users')
              field: user_id
              config:
                severity: warn
      - name: event_type
        description: '{{ doc("event_type") }}'
        tests:
          - not_null
      - name: event_timestamp
        description: '{{ doc("event_timestamp") }}'
        tests:
          - not_null
      - name: session_id
        description: '{{ doc("session_id") }}'
      - name: page
        description: '{{ doc("page") }}'
      - name: amount
        description: '{{ doc("amount") }}'

  - name: stg_raw_users
    description: >
      **Staging model for user data.**
      
      Cleans and standardizes raw user profile data from the landing zone.
      Renames the 'name' field to 'username' for consistency.
      Casts timestamp fields to proper TIMESTAMP types.
      
      **Transformations Applied:**
      - Renames 'name' to 'username'
      - Casts created_at to TIMESTAMP
      - Filters records where user_id is null
      
      **Downstream Usage:**
      - Joined with stg_raw_events in int_events_enriched
      - Foundation for dim_users mart table
    config:
      tags: ['staging', 'users', 'daily']
    columns:
      - name: user_id
        description: '{{ doc("user_id") }}'
        tests:
          - not_null
          - unique
      - name: username
        description: '{{ doc("username") }}'
        tests:
          - not_null
      - name: email
        description: '{{ doc("email") }}'
        tests:
          - not_null
          - unique
      - name: created_at
        description: '{{ doc("created_at") }}'
      - name: country
        description: '{{ doc("country") }}'
